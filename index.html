<!DOCTYPE html>
<html>
<head>
<script>

function registerPaymentHandler() {
      console.log('hello1');
  return navigator.serviceWorker.register('payment_handler.js')
    .then(registration => {
      console.log('hello2');
      if (!registration.paymentManager)
        throw Error('PaymentManager is not supported');
      console.log('hello3');
      console.log(registration.paymentManager.instruments.get('instrument-key'));
      return registration.paymentManager.instruments.get('instrument-key');
    })
    .then(instrument => {
      console.log('hello4');
      console.log(instrument);
      console.log(JSON.stringify(instrument));
      if (instrument)
        return;

      return registration.paymentManager.instruments.set(
        "instrument-key",
        {
          name: 'Payment Handler',
          icons: [],
          enabledMethods: ['basic-card', 'https://emerald-eon.appspot.com/bobpay']
        })
    })
    .then(() => {
      console.log('Payment Handler Registered!');
    });
}

</script>
</head>
<body>
<script>

registerPaymentHandler();

</script>
</body>
</html>
