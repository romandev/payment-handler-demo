<!DOCTYPE html>
<html>
<head>
<script>
      
function addInstruments(registration) {
  const instrumentPromises = [
    registration.paymentManager.instruments.set(
      "dc2de27a-ca5e-4fbd-883e-b6ded6c69d4f",
      {
        name: "My Bob Pay Account",
        icons: [{
          src: "/pay/bobpay.png",
          sizes: "32x32",
          type: "image/png"
        }],
        enabledMethods: ["https://emerald-eon.appspot.com/bobpay"]
      }),
    registration.paymentManager.instruments.set(
      "c8126178-3bba-4d09-8f00-0771deadbeef",
      {
        name: "AliPay (via BobPay)",
        icons: [{
          src: "https://i.alipayobjects.com/common/favicon/favicon.ico",
          sizes: "32x32",
          type: "image/png"
        }],
        enabledMethods: ["https://www.alipay.com/webpay"]
      })
  ];
  return Promise.all(instrumentPromises);
}

function registerPaymentHandler() {
  var keepRegistration;
  return navigator.serviceWorker.register('payment_handler.js')
    .then(registration => {
      keepRegistration = registration;
      if (!registration.paymentManager)
        throw Error('PaymentManager is not supported');
        
      return addInstruments(registration);
    })
    .then(() => {
      console.log('Payment Handler Registered!');
      return keepRegistration.paymentManager.instruments.get("dc2de27a-ca5e-4fbd-883e-b6ded6c69d4f");
    })
    .then(instrument => {
      console.log(instrument);
      return keepRegistration.paymentManager.instruments.get("c8126178-3bba-4d09-8f00-0771deadbeef");
    })
    .then(instrument => {
      console.log(instrument);
    })
}

</script>
</head>
<body>
<script>

registerPaymentHandler();

</script>
</body>
</html>
